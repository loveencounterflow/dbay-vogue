{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/vogue-scheduler.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DBAY-VOGUE/SCHEDULER'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\n( require 'mixa/lib/check-package-versions' ) require '../pinned-package-versions.json'\nGUY                       = require 'guy'\n{ Vogue_common_mixin }    = require './vogue-common-mixin'\n#...........................................................................................................\nH                         = require './helpers'\n\n\n#===========================================================================================================\nclass @Vogue_scheduler extends Vogue_common_mixin()\n\n  #---------------------------------------------------------------------------------------------------------\n  @C: GUY.lft.freeze\n    duration_pattern: /^(?<amount>[-+]?(?:\\d*\\.?\\d+|\\d+\\.?\\d*)(?:[eE][-+]?\\d+)?)\\s(?<unit>.+)$/\n    duration_units: [\n      'week',   'weeks',\n      'day',    'days',\n      'hour',   'hours',\n      'minute', 'minutes',\n      'second', 'seconds', ]\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    super()\n    @cfg        = { @defaults.vogue_scheduler_constructor_cfg..., cfg..., }\n    @types.validate.vogue_scheduler_constructor_cfg @cfg\n    @cfg        = GUY.lft.freeze @cfg\n    @hub        = H.property_pending\n    @rules      = []\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  start: ->\n  stop: ->\n\n  #---------------------------------------------------------------------------------------------------------\n  add_interval: ( cfg ) ->\n    cfg         = { @defaults.vogue_scheduler_add_interval_cfg..., cfg..., }\n    dayjs       = @hub.vdb.db._dayjs\n    @types.validate.vogue_scheduler_add_interval_cfg cfg\n    { callee\n      repeat  } = cfg\n    repeat      = { ( repeat.match @constructor.C.duration_pattern ).groups..., }\n    d           = { running: false, }\n    delta_t_ms  = ( dayjs.duration repeat.amount, repeat.unit ).asMilliseconds()\n    # debug '^342-1^', { cfg, repeat, delta_t_ms, }\n    #.......................................................................................................\n    task = =>\n      return null if d.running\n      #.....................................................................................................\n      d.running   = true\n      t0_ms       = Date.now()\n      #.....................................................................................................\n      return null if ( await callee() ) is false\n      #.....................................................................................................\n      d.running   = false\n      t1_ms       = Date.now()\n      run_dt_ms   = t1_ms - t0_ms\n      ### TAINT what to do when extra_dt is zero, negative? ###\n      extra_dt_ms = ( delta_t_ms - run_dt_ms )\n      extra_dt_s  = ( dayjs.duration extra_dt_ms, 'milliseconds' ).asSeconds()\n      d.ref       = @after extra_dt_s, task\n      # debug '^342-2^', extra_dt_s\n      #.....................................................................................................\n      return null\n    #.......................................................................................................\n    task()\n    return null\n\n  #=========================================================================================================\n  #\n  #---------------------------------------------------------------------------------------------------------\n  every: ( dts, f ) ->                         setInterval f,    dts * 1000\n  after: ( dts, f ) ->                         setTimeout  f,    dts * 1000\n  sleep: ( dts    ) -> new Promise ( done ) => setTimeout  done, dts * 1000\n\n\n\n"
  ]
}